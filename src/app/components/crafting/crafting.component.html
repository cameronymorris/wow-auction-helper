<div class="panel panel-default">
	<div class="panel-heading">
		<h2 class="panel-title">Crafting</h2>
	</div>
	<div class="panel-body">
		<div class="row col-md-12">
			<form class="form-inline" (ngSubmit)="filteRecipes()" [formGroup]="filterForm">

				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Search</span>
					<input class="col-md-2 form-control" type="text" 
						placeholder="Item name" [formControl]="filterForm.controls['searchQuery']" aria-describedby="sizing-addon3"/>
				</div>
				
				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Min profit %</span>
					<input name="profit" class="col-md-2 form-control" type="number" 
						placeholder="0 is default" [formControl]="filterForm.controls['profit']" aria-describedby="sizing-addon3"/>
				</div>


				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Min demand %</span>
					<input class="col-md-2 form-control" type="number" 
						placeholder="0 is default" [formControl]="filterForm.controls['demand']" aria-describedby="sizing-addon3"/>
				</div>

				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Profession</span>
					<select name="profession" class="form-control" [formControl]="filterForm.controls['profession']" aria-describedby="sizing-addon3">
						<option *ngFor="let i of professions" value="{{ i }}">{{ i }}</option>
					</select>
				</div>
				<button class="btn btn-primary" type="submit">Apply filter</button>
			</form>
		</div>
		<br>
		<div class="pager">
			<button class="btn btn-default glyphicon glyphicon-arrow-left" (click)="changePage(-1)"></button>
			<input style="width:5em;" type="number" min="1" [(ngModel)]="currentPage" /> of {{ numOfPages }}
			<button class="btn btn-default glyphicon glyphicon-arrow-right" (click)="changePage(1)"></button>
		</div>
		<table class="table table-striped">
			<tr class="row">
				<th>Name</th>
				<th>Materials</th>
				<th>Cost</th>
				<th>Buyout</th>
				<th>Profit</th>
				<th>avg Posted/Sold</th>
				<th>Demand</th>
			</tr>
			<!-- TODO: optimize price value fetch -->
			<tr class="row" *ngFor="let craft of crafts | slice:(currentPage - 1)*limit : ((currentPage - 1)*limit) + limit ;">
				<td>
					<div>
						<div class="align-left col-md-offset-1">
							<a rel="item={{ craft.itemID }}" href="https://eu.battle.net/wow/en/vault/character/auction/browse?reverse=false&sort=unitBuyout&itemId={craft.itemID}}"
							    target="_blank">{{ craft.name }}</a>
							<br> {{ craft.profession }}
						</div>
					</div>
				</td>
				<td>
					<div class="clearfix" *ngFor="let m of craft.reagents">
						{{ m.count }} x {{m.name}} {{getMinPrice(m.itemID)}}
					</div>
				</td>
				<td>
					{{ goldConversion(craft.cost) }}
				</td>
				<td>
					{{ goldConversion(craft.buyout) }}
				</td>
				<td>
					{{ goldConversion(craft.profit) }} <br> {{ getProfitPercent(craft.profit, craft.buyout) }} %
				</td>
				<td>
					{{ getItem(craft.itemID).avgDailyPosted }} <br> {{ getItem(craft.itemID).avgDailySold }}
				</td>
				<td>
					{{ getItem(craft.itemID).estDemand }}%
				</td>
			</tr>
		</table>
		<div class="pager">
			<button class="btn btn-default glyphicon glyphicon-arrow-left" (click)="changePage(-1)"></button>
			<input style="width:5em;" type="number" min="1" [(ngModel)]="currentPage" /> of {{ numOfPages }}
			<button class="btn btn-default glyphicon glyphicon-arrow-right" (click)="changePage(1)"></button>
		</div>
	</div>
</div>