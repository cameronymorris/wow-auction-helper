<div class="panel panel-default">
	<div class="panel-heading">
		<h2 class="panel-title">Crafting</h2>
	</div>
	<div class="panel-body">
		<p>
			Materials marked with red indicates that the item is not currently at AH, if there 
			is an available market value for that item that will be displayed but not used in cost calculation. <br>
			Blood of Sargarass is calculated in the cost with a value of {{ getMinPrice('124124') }}.
			</p>
		<div class="row col-md-12">
			<form class="form-inline" (ngSubmit)="filteRecipes()" [formGroup]="filterForm">

				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Search</span>
					<input class="col-md-2 form-control" type="text" 
						placeholder="Item name" [formControl]="filterForm.controls['searchQuery']" aria-describedby="sizing-addon3"/>
				</div>
				
				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Min profit</span>
					<input name="profit" class="col-md-2 form-control" type="number" 
						placeholder="0 is default" [formControl]="filterForm.controls['profit']" aria-describedby="sizing-addon3"/>
					<span class="input-group-addon" id="sizing-addon3">%</span>
				</div>


				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Min demand</span>
					<input class="col-md-2 form-control" type="number" 
						placeholder="0 is default" [formControl]="filterForm.controls['demand']" aria-describedby="sizing-addon3"/>
					<span class="input-group-addon" id="sizing-addon3">%</span>
				</div>

				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Min sold</span>
					<input class="col-md-2 form-control" type="number" 
						placeholder="0 is default" [formControl]="filterForm.controls['minSold']" aria-describedby="sizing-addon3"/>
					<span class="input-group-addon" id="sizing-addon3">pcs</span>
				</div>

				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="sizing-addon3">Profession</span>
					<select name="profession" class="form-control" [formControl]="filterForm.controls['profession']" aria-describedby="sizing-addon3">
						<option value="All">All</option>
						<option *ngFor="let i of professions" value="{{ i }}">{{ i }}</option>
					</select>
				</div>
				<button class="btn btn-primary" type="submit">Apply filter</button>
			</form>
		</div>
		<br>
		<div class="col-md-12">
			<div class="pager">
				<button class="btn btn-default glyphicon glyphicon-arrow-left" (click)="changePage(-1)"></button>
				<input style="width:5em;" type="number" min="1" [(ngModel)]="currentPage" /> of {{ numOfPages }}
				<button class="btn btn-default glyphicon glyphicon-arrow-right" (click)="changePage(1)"></button>
			</div>
			<div class="col-md-8">
				<table class="table table-striped">
					<tr class="row">
						<th>Name</th>
						<th>Materials</th>
						<th (click)="sortCrafts('cost')">Cost</th>
						<th (click)="sortCrafts('buyout')">Buyout</th>
						<th (click)="sortCrafts('profit')">Profit</th>
						<th>avg Posted/Sold</th>
						<th (click)="sortCrafts('estDemand')">Demand</th>
					</tr>
					<!-- TODO: optimize price value fetch -->
					<tr class="row" *ngFor="let craft of crafts | slice:(currentPage - 1)*limit : ((currentPage - 1)*limit) + limit ;">
						<td>
							<div>
								<span xmlns="http://www.w3.org/1999/xhtml" class="icon-frame frame-36 align-left" [style.background-image]="'url('+ getIcon(craft.itemID) +')'"></span>
								<div class="align-left col-md-offset-1">
									<a rel="item={{ craft.itemID }}" href="https://eu.battle.net/wow/en/vault/character/auction/browse?reverse=false&sort=unitBuyout&itemId={{craft.itemID}}"
										target="_blank">{{ craft.name }}</a>
									<br> {{ craft.profession }}
								</div>
							</div>
						</td>
						<td>
							<div class="clearfix" *ngFor="let m of craft.reagents" [ngClass]="{'not-found': !isAtAH(m.itemID)}">
								{{ m.count }} x 
								<a rel="item={{ m.itemID }}" href="https://eu.battle.net/wow/en/vault/character/auction/browse?reverse=false&sort=unitBuyout&itemId={{m.itemID}}"
										target="_blank">{{m.name}}</a>
								{{ goldConversion(getMinPrice(m.itemID)) }} ({{ getItem(m.itemID).quantity_total }} @ AH)
							</div>
						</td>
						<td>
							{{ goldConversion(craft.cost) }}
						</td>
						<td>
							{{ goldConversion(craft.buyout) }}
						</td>
						<td>
							{{ goldConversion(craft.profit) }} <br> {{ getProfitPercent(craft.profit, craft.buyout) }} %
						</td>
						<td>
							{{ getItem(craft.itemID).avgDailyPosted }} <br> {{ getItem(craft.itemID).avgDailySold }}
						</td>
						<td>
							{{ craft.estDemand }}% <br>
							<span class="glyphicon glyphicon-shopping-cart" aria-hidden="true" (click)="addToCart(craft)"></span>
						</td>
					</tr>
				</table>
			</div>
			<div class="col-md-4">
				<strong>Shopping cart</strong>
				<ul>
					<li *ngFor="let a of shoppingCart.recipes">
						{{ a.name }} x {{ a.quantity }}
					</li>
				</ul>
				<strong>Reagents</strong>
				<ul>
					<li *ngFor="let a of shoppingCart.reagents">
						{{ a.name }} x {{ a.count }} Ã  {{ goldConversion( getMinPrice(a.itemID) * a.count) }}
					</li>
				</ul>
			</div>
		</div>
		<div class="pager">
			<button class="btn btn-default glyphicon glyphicon-arrow-left" (click)="changePage(-1)"></button>
			<input style="width:5em;" type="number" min="1" [(ngModel)]="currentPage" /> of {{ numOfPages }}
			<button class="btn btn-default glyphicon glyphicon-arrow-right" (click)="changePage(1)"></button>
		</div>
	</div>
</div>