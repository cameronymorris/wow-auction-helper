<div class="panel panel-default">
	<div class="panel-heading">
		<h2 class="panel-title">Watchlist</h2>
	</div>
	<div class="panel-body">
		<p>
			You will be notified of any item on your watchlist, that are below your defined threshold.
			If you don't get notifications, you might have disabeled it in your browser.
		</p>

		<!-- Item groups -->
		<div *ngIf="display.groups">
			<form class="input-group" (ngSubmit)="addGroup()">
				<span class="input-group-addon" id="basic-addon1">Item name</span>
				<input type="text" [formControl]="groupForm.controls['name']" class="form-control" placeholder="Group name" aria-describedby="basic-addon1">
				<span class="input-group-btn">
			        <button class="btn btn-default" type="submit">Add</button>
		      </span>
			</form>
			<table class="table table-striped">
				<tr>
					<th>Item</th>
					<th>Item count</th>
					<th>Action</th>
				</tr>
				<tr *ngFor="let group of watchlist.groups; let i = index">
					<td>
						{{ group }}
					</td>
					<td>
						{{ watchlist.items[group] ? watchlist.items[group].length : 0 }}
					</td>
					<td>
						<span class="btn btn-primary pull-right" (click)="removeGroup(i)">
							<i class="glyphicon glyphicon-trash"></i>
							Delete
						</span>
						<span *ngIf="i !== watchlist.groups.length - 1" class="pull-right" (click)="moveGroup(group, 1)">
							<i class="glyphicon glyphicon-arrow-down"></i>
						</span>
						<span *ngIf="i > 0" class="pull-right" (click)="moveGroup(group, -1)">
							<i class="glyphicon glyphicon-arrow-up"></i>
						</span>
					</td>
				</tr>
			</table>
		</div>

		<!-- Item query -->
		<div>
			<span *ngIf="display.itemSearch; else itemSearch"
				class="btn btn-primary"
				(click)="display.toggleSearchItem()">
				<i class="glyphicon glyphicon-eye-open" aria-hidden="true"></i>Show item search
			</span>
			<ng-template #itemSearch>
				<span class="btn btn-primary"
					(click)="display.toggleSearchItem()"><i class="glyphicon glyphicon-eye-close" aria-hidden="true"></i>Hide item search</span>
			</ng-template>
		</div>
		<div *ngIf="display.itemSearch">
			<form class="input-group" (ngSubmit)="searchItemDB()">
				<span class="input-group-addon" id="basic-addon1">Item name</span>
				<input type="text" [formControl]="itemSearchForm.controls['searchQuery']" class="form-control" placeholder="Item name starts with" aria-describedby="basic-addon1">
				<span class="input-group-btn">
			        <button class="btn btn-default" type="submit">Search</button>
		      </span>
			</form>

			<table class="table table-striped">
				<tr>
					<th>Item</th>
					<th>Alert price in copper</th>
					<th>Alert price</th>
					<th>Group</th>
					<th>Action</th>
				</tr>
				<tr *ngFor="let item of queryItems">
					<td>
						<span xmlns="http://www.w3.org/1999/xhtml" class="icon-frame frame-24 align-left" [style.background-image]="'url('+ getIcon(item) +')'"></span>
						<a  rel="item={{ item.itemID }}" href="#" target="_blank">
							{{ item.name }}
						</a><br>
					</td>
					<td><input type="number" [(ngModel)]="item.value"/></td>
					<td>{{ copperToArray(item.value || 0) }}</td>
					<td>
						<select [(ngModel)]="item.group">
							<option *ngFor="let group of watchlist.groups" [value]="group">
								{{ group }}
							</option>
						</select>
					</td>
					<td>
						<span class="btn btn-primary pull-right" (click)="addItemToWatchlist(item)">
							<i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
							Add
						</span>
					</td>
				</tr>
			</table>
		</div>

		<!-- Watchlist items -->
		<div *ngFor="let group of watchlist.groups; let i = index">
			<div *ngIf="watchlist.items[group]" class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						{{ group }}
					</h3>
					<div class="pull-right">
						<span *ngIf="i !== watchlist.groups.length - 1" class="pull-right" (click)="moveGroup(group, 1)">
							<i class="glyphicon glyphicon-arrow-down"></i>
						</span>
						<span *ngIf="i > 0" class="pull-right" (click)="moveGroup(group, -1)">
							<i class="glyphicon glyphicon-arrow-up"></i>
						</span>
					</div>
				</div>


				<table class="table table-striped panel-body">
					<tr>
						<th>Item</th>
						<th>Buyout</th>
						<th>Alert price</th>
						<th>Action</th>
					</tr>
					<tr *ngFor="let item of watchlist.items[group]; let i = index">
						<td>
							<span xmlns="http://www.w3.org/1999/xhtml" class="icon-frame frame-24 align-left" [style.background-image]="'url('+ getIcon(item) +')'"></span>
							<a  rel="item={{ item.id }}" href="#" target="_blank">
								{{ item.name }}
							</a><br>
							{{ getItemRecipes(item.id) | json }}
						</td>
						<td>{{ copperToArray(getBuyout(item.id)) }}</td>
						<td>{{ copperToArray(item.belowValue) }}</td>
						<td>
							<div class="pull-right">
								<span class="btn btn-primary" (click)="editItemDialog(group, i)">
									<i class="glyphicon glyphicon-edit"></i>
									Edit
								</span>
								<span class="btn btn-primary" (click)="removeItem(group, i)">
									<i class="glyphicon glyphicon-trash"></i>
									Delete
								</span>
							</div>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</div>


<!-- Modal for deleting groups with items in them-->
<div id="group-modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">
					<i class="glyphicon glyphicon-remove"></i>
				</button>
				<h4 class="modal-title">
					Deleting "{{ watchlist.groups[editing.group.index] }}"
				</h4>
			</div>
			<div class="modal-body">
				<p>
					You are attempting to delete a group with items connected to it.
					You can either move the items to a new
					group and delete it, or delete the items and the group.
				</p>
			</div>
			<div class="modal-footer">
				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="basic-addon1">Move to</span>
					<select *ngIf="editing.group" type="text" placeholder="Group name" aria-describedby="basic-addon1">
						<option *ngFor="let group of watchlist.groups" [value]="group" [selected]="group === watchlist.groups[editing.group.index]">
							{{ group }}
						</option>
					</select>
				</div>
				<button type="button" class="btn btn-default" data-dismiss="modal" (click)="removeGroupWithItems()">Delete</button>
			</div>
		</div>

	</div>
</div>
<!-- Modal for editing items -->
<div id="item-modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">
					<i class="glyphicon glyphicon-remove"></i>
				</button>
				<h4 class="modal-title">
					{{ editing.item?.name }}
				</h4>
			</div>
			<div class="modal-body">
				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="basic-addon1">Change group</span>
					<select *ngIf="editing.item" type="text" placeholder="Group name" aria-describedby="basic-addon1" [(ngModel)]="editing.item.group">
						<option *ngFor="let group of watchlist.groups" [value]="group" [selected]="group === editing.item.group">
							{{ group }}
						</option>
					</select>
				</div>
				<div class="input-group input-group-sm">
					<span class="input-group-addon" id="basic-addon1">Alert value in copper</span>
					<input *ngIf="editing.item" type="number" placeholder="value in copper" aria-describedby="basic-addon1" [(ngModel)]="editing.item.belowValue">
						<span class="input-group-addon" id="basic-addon1">{{ copperToArray(editing.item?.belowValue) }}</span>
				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close and close</button>
			</div>
		</div>

	</div>
</div>
